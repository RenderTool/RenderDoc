import{_ as c,r as i,o as l,c as u,d as s,w as t,a as n,b as a,e as p}from"./app-7652dc60.js";const d="/RenderDoc/assets/uiinputmode-e5cf27f7.jpg",r="/RenderDoc/assets/checkout-78662e1c.jpg",k="/RenderDoc/assets/inputconfig-329c6e19.jpg",m="/RenderDoc/assets/lyrainputmode-57a8cb39.jpg",v="/RenderDoc/assets/printhello-f3baa5a9.jpg",b="/RenderDoc/assets/UCommonInputActionDomain-6bfd6cca.jpg",g="data:image/jpeg;base64,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",h="/RenderDoc/assets/commonuiroot-eb8c5206.jpg",A={},f=n("h2",{id:"导读",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#导读","aria-hidden":"true"},"#"),a(" 导读")],-1),I=n("h2",{id:"前置条件",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#前置条件","aria-hidden":"true"},"#"),a(" 前置条件")],-1),y=n("blockquote",null,[n("p",null,"安装插件CommonUI")],-1),E=n("h2",{id:"实践",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#实践","aria-hidden":"true"},"#"),a(" 实践")],-1),C=n("blockquote",null,[n("p",null,"日常心血来潮，想给我的游戏菜单背景加一个角色查看功能，即：可以操作UI的同时控制游戏模型（比如旋转、缩放等）。")],-1),M=n("figure",null,[n("img",{src:d,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),W=n("blockquote",null,[n("p",null,"悲剧发生了！")],-1),w=n("iframe",{src:"https://blueprintue.com/render/0j9cetp9/",width:"100%",height:"500",scrolling:"no",allowfullscreen:""},null,-1),U=n("hr",null,null,-1),x=n("blockquote",null,[n("p",null,"可咱用的是CommonUI啊！")],-1),_=n("figure",null,[n("img",{src:r,alt:"checkout.jpg",tabindex:"0",loading:"lazy"}),n("figcaption",null,"checkout.jpg")],-1),j=n("figure",null,[n("img",{src:k,alt:"截自官方文档",tabindex:"0",loading:"lazy"}),n("figcaption",null,"截自官方文档")],-1),D=n("hr",null,null,-1),B=n("h2",{id:"lyra的实现",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#lyra的实现","aria-hidden":"true"},"#"),a(" Lyra的实现")],-1),K=n("blockquote",null,[n("p",null,"后来我发现Lyra通过封装InputConfig和GameMouseCaptureMod两个核心模块完美解决了上面的问题。")],-1),N=n("figure",null,[n("img",{src:m,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),q=p(`<h3 id="_1-核心配置-inputconfig" tabindex="-1"><a class="header-anchor" href="#_1-核心配置-inputconfig" aria-hidden="true">#</a> 1. 核心配置 InputConfig:</h3><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">EWidgetInputMode</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">uint8</span></span>
<span class="token punctuation">{</span>
   Default<span class="token punctuation">,</span>
   GameAndMenu<span class="token punctuation">,</span>
   Game<span class="token punctuation">,</span>
   Menu
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),F=n("ul",null,[n("li",null,"Default & Menu 鼠标只能操作UI")],-1),G=n("ul",null,[n("li",null,"GameAndMenu ：鼠标能操作UI，也能移动游戏视口")],-1),O=n("ul",null,[n("li",null,"Game:鼠标无法操作UI，只能移动游戏视口。")],-1),R=p(`<hr><h3 id="_2-核心配置-game-mouse-capture-mode" tabindex="-1"><a class="header-anchor" href="#_2-核心配置-game-mouse-capture-mode" aria-hidden="true">#</a> 2.核心配置 Game Mouse Capture Mode ：</h3><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">EMouseCaptureMode</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">uint8</span></span>
<span class="token punctuation">{</span>
 <span class="token comment">/** 不捕获鼠标输入 */</span>
 NoCapture<span class="token punctuation">,</span>
 <span class="token comment">/** 当视口被点击时，永久捕获鼠标，并消耗引起捕获的初始鼠标按下事件，以防止被玩家输入处理 */</span>
 CapturePermanently<span class="token punctuation">,</span>
 <span class="token comment">/** 当视口被点击时，永久捕获鼠标，并允许玩家输入处理引起捕获的初始鼠标按下事件 */</span>
 CapturePermanently_IncludingInitialMouseDown<span class="token punctuation">,</span>
 <span class="token comment">/** 在鼠标按下期间捕获鼠标，鼠标抬起时释放 */</span>
 CaptureDuringMouseDown<span class="token punctuation">,</span>
 <span class="token comment">/** 仅在右鼠标按钮按下时捕获，而不捕获其他任何鼠标按钮 */</span>
 CaptureDuringRightMouseDown<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),T=n("figure",null,[n("img",{src:v,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),L=p('<hr><h3 id="_3-其他配置-consume-pointer-input" tabindex="-1"><a class="header-anchor" href="#_3-其他配置-consume-pointer-input" aria-hidden="true">#</a> 3. 其他配置 Consume Pointer Input:</h3><blockquote><p>很多人应该和我一样，一开始压根不明白这个节点的意思。</p></blockquote><p>当一个UI元素接收到鼠标点击或触摸输入时，通常会有一个属性或方法可以设置为&quot;Consume pointer input&quot;。 这意味着该UI元素会消耗掉这个输入事件，阻止它继续传递到下层的UI元素或游戏场景中。</p><hr><h3 id="_4-其他配置-action-domain-override" tabindex="-1"><a class="header-anchor" href="#_4-其他配置-action-domain-override" aria-hidden="true">#</a> 4.其他配置 Action Domain Override:</h3><p>数据资产配置类，在游戏开发中，特定的场景或状态可能会覆盖默认的动作控制<br></p><p>例如：我想配置一个全局的输、鼠标交互模式。</p><figure><img src="'+b+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>Display in ActionBar :简单来说就是对应的按键UI显示在指定的动作栏中。类似下面的效果：</li></ul><figure><img src="'+g+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="源码剖析" tabindex="-1"><a class="header-anchor" href="#源码剖析" aria-hidden="true">#</a> 源码剖析</h2><p><code>ActivatableWidget.h</code></p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// Copyright Epic Games, Inc. All Rights Reserved.</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;CommonActivatableWidget.h&quot;</span><span class="token comment">//引入CommonActivatableWidget</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ExorcistActivatableWidget.generated.h&quot;</span><span class="token comment">//UHT生成</span></span>

<span class="token comment">//InputConfig结构体</span>
<span class="token keyword">struct</span> <span class="token class-name">FUIInputConfig</span><span class="token punctuation">;</span>

<span class="token function">UENUM</span><span class="token punctuation">(</span>BlueprintType<span class="token punctuation">)</span>
<span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">EExorcistWidgetInputMode</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">uint8</span></span>
<span class="token punctuation">{</span>
	Default<span class="token punctuation">,</span>     <span class="token comment">// 默认模式</span>
	GameAndMenu<span class="token punctuation">,</span> <span class="token comment">// 游戏和菜单模式</span>
	Game<span class="token punctuation">,</span>        <span class="token comment">// 游戏模式</span>
	Menu         <span class="token comment">// 菜单模式</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// An activatable widget that automatically drives the desired input config when activated</span>
<span class="token comment">// 一个可激活的小部件，在激活时会自动驱动所需的输入配置</span>
<span class="token function">UCLASS</span><span class="token punctuation">(</span>Abstract<span class="token punctuation">,</span> Blueprintable<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UExorcistActivatableWidget</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">UCommonActivatableWidget</span><span class="token comment">//继承自UCommonActivatableWidget</span></span>
<span class="token punctuation">{</span>
	<span class="token function">GENERATED_BODY</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">UExorcistActivatableWidget</span><span class="token punctuation">(</span><span class="token keyword">const</span> FObjectInitializer<span class="token operator">&amp;</span> ObjectInitializer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//构造函数，</span>
	
<span class="token keyword">public</span><span class="token operator">:</span>
	
	<span class="token comment">//~UCommonActivatableWidget interface</span>
	<span class="token comment">//~UCommonActivatableWidget 接口</span>
	<span class="token keyword">virtual</span> TOptional<span class="token operator">&lt;</span>FUIInputConfig<span class="token operator">&gt;</span> <span class="token function">GetDesiredInputConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span><span class="token punctuation">;</span><span class="token comment">// 获取所需的输入配置</span>
	<span class="token comment">//~End of UCommonActivatableWidget interface</span>
	<span class="token comment">//~End of UCommonActivatableWidget 接口</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">WITH_EDITOR</span></span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">ValidateCompiledWidgetTree</span><span class="token punctuation">(</span><span class="token keyword">const</span> UWidgetTree<span class="token operator">&amp;</span> BlueprintWidgetTree<span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">IWidgetCompilerLog</span><span class="token operator">&amp;</span> CompileLog<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	
<span class="token keyword">protected</span><span class="token operator">:</span>
	<span class="token comment">/** 激活此 UI 时要使用的所需输入模式，例如您是否希望按键仍然传递到游戏/玩家控制器？ */</span>
	<span class="token comment">/** The desired input mode to use while this UI is activated, for example do you want key presses to still reach the game/player controller? */</span>
	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditDefaultsOnly<span class="token punctuation">,</span> Category <span class="token operator">=</span> Input<span class="token punctuation">)</span>
	EExorcistWidgetInputMode InputConfig <span class="token operator">=</span> EExorcistWidgetInputMode<span class="token double-colon punctuation">::</span>Default<span class="token punctuation">;</span>
	
	<span class="token comment">/** 游戏接收输入时所需的鼠标行为。 */</span>
	<span class="token comment">/** The desired mouse behavior when the game gets input. */</span>
	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditDefaultsOnly<span class="token punctuation">,</span> Category <span class="token operator">=</span> Input<span class="token punctuation">)</span>
	EMouseCaptureMode GameMouseCaptureMode <span class="token operator">=</span> EMouseCaptureMode<span class="token double-colon punctuation">::</span>CapturePermanently<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ActivatableWidget.cpp</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// 版权所有 Epic Games, Inc. 保留所有权利。</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;UI/ExorcistActivatableWidget.h&quot;</span> <span class="token comment">// 引入ExorcistActivatableWidget头文件</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;Editor/WidgetCompilerLog.h&quot;</span> <span class="token comment">// 引入WidgetCompilerLog头文件</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token expression"><span class="token function">UE_INLINE_GENERATED_CPP_BY_NAME</span><span class="token punctuation">(</span>ExorcistActivatableWidget<span class="token punctuation">)</span> </span><span class="token comment">// 使用宏生成内联的C++代码</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LOCTEXT_NAMESPACE</span> <span class="token string">&quot;Exorcist&quot;</span> <span class="token comment">// 定义命名空间 &quot;Exorcist&quot;</span></span>

<span class="token class-name">UExorcistActivatableWidget</span><span class="token double-colon punctuation">::</span><span class="token function">UExorcistActivatableWidget</span><span class="token punctuation">(</span><span class="token keyword">const</span> FObjectInitializer<span class="token operator">&amp;</span> ObjectInitializer<span class="token punctuation">)</span>
	<span class="token operator">:</span> <span class="token function">Super</span><span class="token punctuation">(</span>ObjectInitializer<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

TOptional<span class="token operator">&lt;</span>FUIInputConfig<span class="token operator">&gt;</span> <span class="token class-name">UExorcistActivatableWidget</span><span class="token double-colon punctuation">::</span><span class="token function">GetDesiredInputConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>InputConfig<span class="token punctuation">)</span> <span class="token comment">// 根据InputConfig的值进行不同的处理</span>
	<span class="token punctuation">{</span>
	<span class="token keyword">case</span> EExorcistWidgetInputMode<span class="token double-colon punctuation">::</span>GameAndMenu<span class="token operator">:</span> <span class="token comment">// 如果InputConfig是GameAndMenu模式</span>
		<span class="token keyword">return</span> <span class="token function">FUIInputConfig</span><span class="token punctuation">(</span>ECommonInputMode<span class="token double-colon punctuation">::</span>All<span class="token punctuation">,</span> GameMouseCaptureMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个包含All输入模式和GameMouseCaptureMode的FUIInputConfig</span>
	<span class="token keyword">case</span> EExorcistWidgetInputMode<span class="token double-colon punctuation">::</span>Game<span class="token operator">:</span> <span class="token comment">// 如果InputConfig是Game模式</span>
		<span class="token keyword">return</span> <span class="token function">FUIInputConfig</span><span class="token punctuation">(</span>ECommonInputMode<span class="token double-colon punctuation">::</span>Game<span class="token punctuation">,</span> GameMouseCaptureMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个包含Game输入模式和GameMouseCaptureMode的FUIInputConfig</span>
	<span class="token keyword">case</span> EExorcistWidgetInputMode<span class="token double-colon punctuation">::</span>Menu<span class="token operator">:</span> <span class="token comment">// 如果InputConfig是Menu模式</span>
		<span class="token keyword">return</span> <span class="token function">FUIInputConfig</span><span class="token punctuation">(</span>ECommonInputMode<span class="token double-colon punctuation">::</span>Menu<span class="token punctuation">,</span> EMouseCaptureMode<span class="token double-colon punctuation">::</span>NoCapture<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个包含Menu输入模式和NoCapture的FUIInputConfig</span>
	<span class="token keyword">case</span> EExorcistWidgetInputMode<span class="token double-colon punctuation">::</span>Default<span class="token operator">:</span> <span class="token comment">// 默认情况</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">TOptional</span><span class="token generic class-name"><span class="token operator">&lt;</span>FUIInputConfig<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个空的TOptional&lt;FUIInputConfig&gt;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">WITH_EDITOR</span></span>

<span class="token keyword">void</span> <span class="token class-name">UExorcistActivatableWidget</span><span class="token double-colon punctuation">::</span><span class="token function">ValidateCompiledWidgetTree</span><span class="token punctuation">(</span><span class="token keyword">const</span> UWidgetTree<span class="token operator">&amp;</span> BlueprintWidgetTree<span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">IWidgetCompilerLog</span><span class="token operator">&amp;</span> CompileLog<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
	<span class="token class-name">Super</span><span class="token double-colon punctuation">::</span><span class="token function">ValidateCompiledWidgetTree</span><span class="token punctuation">(</span>BlueprintWidgetTree<span class="token punctuation">,</span> CompileLog<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用父类的ValidateCompiledWidgetTree函数</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">IsFunctionImplementedInScript</span><span class="token punctuation">(</span><span class="token function">GET_FUNCTION_NAME_CHECKED</span><span class="token punctuation">(</span>UExorcistActivatableWidget<span class="token punctuation">,</span> BP_GetDesiredFocusTarget<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">GetParentNativeClass</span><span class="token punctuation">(</span><span class="token function">GetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">UExorcistActivatableWidget</span><span class="token double-colon punctuation">::</span><span class="token function">StaticClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			CompileLog<span class="token punctuation">.</span><span class="token function">Warning</span><span class="token punctuation">(</span><span class="token function">LOCTEXT</span><span class="token punctuation">(</span><span class="token string">&quot;ValidateGetDesiredFocusTarget_Warning&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GetDesiredFocusTarget wasn&#39;t implemented, you&#39;re going to have trouble using gamepads on this screen.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//TODO - Note for now, because we can&#39;t guarantee it isn&#39;t implemented in a native subclass of this one.</span>
			CompileLog<span class="token punctuation">.</span><span class="token function">Note</span><span class="token punctuation">(</span><span class="token function">LOCTEXT</span><span class="token punctuation">(</span><span class="token string">&quot;ValidateGetDesiredFocusTarget_Note&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GetDesiredFocusTarget wasn&#39;t implemented, you&#39;re going to have trouble using gamepads on this screen.  If it was implemented in the native base class you can ignore this message.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">LOCTEXT_NAMESPACE </span><span class="token comment">// 取消命名空间 &quot;Exorcist&quot;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16),S=n("h2",{id:"回顾",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#回顾","aria-hidden":"true"},"#"),a(" 回顾")],-1),P=p('<figure><img src="'+h+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="扩展" tabindex="-1"><a class="header-anchor" href="#扩展" aria-hidden="true">#</a> 扩展</h2><p>怎么通过蓝图节点进行输入模式的切换设置呢。</p><p>简单！将 <code>EditDefaultsOnly</code> 修改为 <code>EditAnywhere</code>，这样就可以在蓝图中任何地方编辑该属性了。就ok了！</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// ExorcistActivatableWidget.h</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
	<span class="token comment">/** 激活此 UI 时要使用的所需输入模式，例如您是否希望按键仍然传递到游戏/玩家控制器？ */</span>
	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditAnywhere<span class="token punctuation">,</span> Category <span class="token operator">=</span> Input<span class="token punctuation">)</span>
	EExorcistWidgetInputMode InputConfig <span class="token operator">=</span> EExorcistWidgetInputMode<span class="token double-colon punctuation">::</span>Default<span class="token punctuation">;</span> <span class="token comment">// 输入模式</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="流程" tabindex="-1"><a class="header-anchor" href="#流程" aria-hidden="true">#</a> 流程</h3><p>首先，我们在头文件中添加新的声明：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// ExorcistActivatableWidget.h</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;CoreMinimal.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;UI/ExorcistActivatableWidget.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;ExorcistBlueprintFunctionLibrary.generated.h&quot;</span></span>

<span class="token comment">/**
 * 
 */</span>
<span class="token function">UCLASS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">YOURPROJECT_API</span> UExorcistBlueprintFunctionLibrary <span class="token operator">:</span> <span class="token keyword">public</span> UBlueprintFunctionLibrary
<span class="token punctuation">{</span>
	<span class="token function">GENERATED_BODY</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">UFUNCTION</span><span class="token punctuation">(</span>BlueprintCallable<span class="token punctuation">,</span> Category <span class="token operator">=</span> <span class="token string">&quot;Exorcist&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">SetExorcistInputMode</span><span class="token punctuation">(</span>UExorcistActivatableWidget<span class="token operator">*</span> ActivatableWidget<span class="token punctuation">,</span> EExorcistWidgetInputMode InputMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，你可以在蓝图中调用 <code>SetInputMode</code> 来设置输入模式了。</p><p>同样的：将 <code>EMouseCaptureMode</code> 的设置也封装成一个函数，以便在其他地方调用。</p><p>首先，在 <code>UExorcistActivatableWidget</code> 类中添加一个新的函数用于设置鼠标捕获模式：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// ExorcistActivatableWidget.h</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">// 设置鼠标捕获模式</span>
	<span class="token function">UFUNCTION</span><span class="token punctuation">(</span>BlueprintCallable<span class="token punctuation">,</span> Category <span class="token operator">=</span> <span class="token string">&quot;Exorcist&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">void</span> <span class="token function">SetMouseCaptureMode</span><span class="token punctuation">(</span>EMouseCaptureMode NewCaptureMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在源文件中实现这个函数：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// ExorcistActivatableWidget.cpp</span>

<span class="token keyword">void</span> <span class="token class-name">UExorcistActivatableWidget</span><span class="token double-colon punctuation">::</span><span class="token function">SetMouseCaptureMode</span><span class="token punctuation">(</span>EMouseCaptureMode NewCaptureMode<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	GameMouseCaptureMode <span class="token operator">=</span> NewCaptureMode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14);function V(Q,H){const e=i("chatmessage"),o=i("gifwithbutton");return l(),u("div",null,[f,s(e,{avatar:"../../assets/emoji/dsyj.png",avatarWidth:40},{default:t(()=>[a(" 官方文档介绍CommonUI虽然提供了InputMode函数：UCommonActivatableWidget::GetDesiredInputConfig却没有给出对应的蓝图节点已经属性操作。 本章节从Lyra的InputConfig出发，观察理解LyraInputmode实现细节。 ")]),_:1}),I,y,E,C,s(e,{avatar:"../../assets/emoji/blzt.png",avatarWidth:40},{default:t(()=>[a(" 这还不简单！构造函数里设置一下输入模式`游戏和UI` ")]),_:1}),M,W,s(e,{avatar:"../../assets/emoji/kclr.png",avatarWidth:40},{default:t(()=>[a(" 运行后根本无法操作UI后面的场景！ ")]),_:1}),s(o,{src:"../../assets/unrealgif/gamenotmove.gif"}),s(e,{avatar:"../../assets/emoji/hx.png",avatarWidth:40},{default:t(()=>[a(" 如果没记错的话原系统中我们要修改输入模式确实是这几个节点。 ")]),_:1}),w,U,x,s(e,{avatar:"../../assets/emoji/blzt.png",avatarWidth:40},{default:t(()=>[a(" 最后发现设置里可以通过SupportsActivationFocus关闭来开启游戏和UI这种输入模式。完美！再次编译运行！ ")]),_:1}),_,s(e,{avatar:"../../assets/emoji/bqb (5).png",avatarWidth:40},{default:t(()=>[a(" But！当你来回切换几个UI界面后，你发现你的视口又不能动了！总不能所有界面都设置SupportsActivationFocus吧！而且这卡顿是怎么回事啊！ ")]),_:1}),s(o,{src:"../../assets/unrealgif/menu.gif"}),s(e,{avatar:"../../assets/emoji/kclr.png",avatarWidth:40},{default:t(()=>[a(" 官方S一样的文档中也找不对应的节点只给了一个实现函数。 ")]),_:1}),j,D,B,s(o,{src:"../../assets/unrealgif/gameandmenu.gif"}),K,N,s(e,{avatar:"../../assets/emoji/bqb (6).png",avatarWidth:40,alignLeft:""},{default:t(()=>[a(" 很好！是时候学习一下新科学知识了！ ")]),_:1}),q,s(e,{avatar:"../../assets/emoji/blzt.png",avatarWidth:40},{default:t(()=>[a(" 这个应该看得懂，默认的几种输入模式。 ")]),_:1}),F,s(o,{src:"../../assets/unrealgif/menu.gif"}),G,s(o,{src:"../../assets/unrealgif/gameandmenu.gif"}),O,s(o,{src:"../../assets/unrealgif/game.gif"}),s(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[a(" 最终，BABA还是担心你看不懂，做了几个动画演示。 ")]),_:1}),R,s(e,{avatar:"../../assets/emoji/blzt.png",avatarWidth:40},{default:t(()=>[a(" 等等!Baba有个问题:Game模式下，一定不能控制UI吗？ ")]),_:1}),s(e,{avatar:"../../assets/emoji/bqb (1).png",avatarWidth:40,alignLeft:""},{default:t(()=>[a(" 可以测试一下！给按钮加一个打印节点。 ")]),_:1}),T,s(e,{avatar:"../../assets/emoji/bqb (3).png",avatarWidth:40,alignLeft:""},{default:t(()=>[a(" 然后我们将鼠标永久捕获改成按下期间捕获。 ")]),_:1}),s(o,{src:"../../assets/unrealgif/mousebuhuo.gif"}),s(e,{avatar:"../../assets/emoji/blzt.png",avatarWidth:40},{default:t(()=>[a(" 为什么Game模式下也能控制UI? ")]),_:1}),s(e,{avatar:"../../assets/emoji/bqb (5).png",avatarWidth:40,alignLeft:""},{default:t(()=>[a(" 从视觉上分析，鼠标按下期间捕获的过程相当于Menu和Game模式的切换，一结合也就变成了GameAndMenu的效果。 ")]),_:1}),L,s(e,{avatar:"../../assets/emoji/bqb (6).png",avatarWidth:40},{default:t(()=>[a(" 打住打住！你管这叫源码剖析？ ")]),_:1}),S,s(e,{avatar:"../../assets/emoji/dsyj.png",avatarWidth:40,alignLeft:""},{default:t(()=>[a(" 很好!我们从头分析！我们先来重新复习一下CommonUI有哪些现成的Widget类 ")]),_:1}),P])}const X=c(A,[["render",V],["__file","2-ImproveCommonUI.html.vue"]]);export{X as default};
