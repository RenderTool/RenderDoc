"use strict";(self.webpackChunkrenderdoc=self.webpackChunkrenderdoc||[]).push([[9471],{16202:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>c,data:()=>l});var t=a(20641);const p=(0,t.Fv)('<h2 id="ui焦点问题" tabindex="-1"><a class="header-anchor" href="#ui焦点问题"><span>UI焦点问题</span></a></h2><h2 id="导言" tabindex="-1"><a class="header-anchor" href="#导言"><span>导言</span></a></h2><blockquote><p>最近在做道具轮盘，大致流程是按下某个按键，弹出一个轮盘，使用鼠标或者手柄来选择某个插槽。 本篇记录一下实现中的一些坑。</p></blockquote><h3 id="实现原理" tabindex="-1"><a class="header-anchor" href="#实现原理"><span>实现原理</span></a></h3><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>\nFVector2D <span class="token class-name">URadialWheelWidget</span><span class="token double-colon punctuation">::</span><span class="token function">GetWheelCenterPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n\t<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>WheelOverlay<span class="token punctuation">)</span>\n\t<span class="token punctuation">{</span>\n\t\t<span class="token keyword">return</span> FVector2D<span class="token double-colon punctuation">::</span>ZeroVector<span class="token punctuation">;</span>\n\t<span class="token punctuation">}</span>\n\n\t<span class="token comment">// 获取 Overlay 的几何信息</span>\n\t<span class="token keyword">const</span> FGeometry<span class="token operator">&amp;</span> Geometry <span class="token operator">=</span> WheelOverlay<span class="token operator">-&gt;</span><span class="token function">GetCachedGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\t<span class="token comment">// 本地中心点</span>\n\t<span class="token keyword">const</span> FVector2D LocalCenter <span class="token operator">=</span> Geometry<span class="token punctuation">.</span><span class="token function">GetLocalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>\n\n\t<span class="token comment">// 转换到绝对屏幕坐标</span>\n\tFVector2D PixelPosition<span class="token punctuation">;</span>\n\tFVector2D ViewportPosition<span class="token punctuation">;</span>\n\t<span class="token class-name">USlateBlueprintLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">LocalToViewport</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Geometry<span class="token punctuation">,</span> LocalCenter<span class="token punctuation">,</span> PixelPosition<span class="token punctuation">,</span> ViewportPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\t<span class="token comment">// 加上DPI缩放</span>\n\t<span class="token keyword">return</span> ViewportPosition <span class="token operator">*</span> <span class="token class-name">UWidgetLayoutLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">GetViewportScale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">void</span> <span class="token class-name">URadialWheelWidget</span><span class="token double-colon punctuation">::</span><span class="token function">CalcAngleAndDistanceFromDir</span><span class="token punctuation">(</span><span class="token keyword">const</span> FVector2D<span class="token operator">&amp;</span> Dir<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">&amp;</span> OutAngle<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> OutDistance<span class="token punctuation">)</span> <span class="token keyword">const</span>\n<span class="token punctuation">{</span>\n\tOutDistance <span class="token operator">=</span> Dir<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\t<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Dir<span class="token punctuation">.</span><span class="token function">IsNearlyZero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\t<span class="token punctuation">{</span>\n\t    <span class="token comment">// Y 翻转</span>\n\t\tOutAngle <span class="token operator">=</span> <span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">RadiansToDegrees</span><span class="token punctuation">(</span><span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">Atan2</span><span class="token punctuation">(</span>Dir<span class="token punctuation">.</span>Y<span class="token punctuation">,</span> Dir<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">90.f</span><span class="token punctuation">;</span>\n\t\tOutAngle <span class="token operator">=</span> <span class="token class-name">FRotator</span><span class="token double-colon punctuation">::</span><span class="token function">ClampAxis</span><span class="token punctuation">(</span>OutAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t<span class="token punctuation">}</span>\n\t<span class="token keyword">else</span>\n\t<span class="token punctuation">{</span>\n\t\tOutDistance <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>\n\t\tOutAngle <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>\n\t<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\nFVector2D <span class="token class-name">URadialWheelWidget</span><span class="token double-colon punctuation">::</span><span class="token function">GetMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">float</span> Angle <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>\n\t<span class="token keyword">double</span> Distance <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>\n\n\t<span class="token comment">//1. 获取鼠标在屏幕中的绝对位置（考虑DPI缩放）</span>\n\t<span class="token keyword">const</span> FVector2D MousePos <span class="token operator">=</span> <span class="token class-name">UWidgetLayoutLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">GetMousePositionOnViewport</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">*</span>\n\t\t\t\t\t\t\t<span class="token class-name">UWidgetLayoutLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">GetViewportScale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//2.获取轮盘中心坐标</span>\n\t<span class="token keyword">const</span> FVector2D Center <span class="token operator">=</span> <span class="token function">GetWheelCenterPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//3.计算偏移向量</span>\n\t<span class="token keyword">const</span> FVector2D Dir <span class="token operator">=</span> MousePos <span class="token operator">-</span> Center<span class="token punctuation">;</span>\n\t\n\t<span class="token comment">//4.计算角度和距离</span>\n\t<span class="token function">CalcAngleAndDistanceFromDir</span><span class="token punctuation">(</span>Dir<span class="token punctuation">,</span> Angle<span class="token punctuation">,</span> Distance<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\t\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',5),o=(0,t.Lk)("p",null,[(0,t.eW)("这里比较重要的知识点是坐标系的转化，UE用的是反笛卡尔坐标系，即"),(0,t.Lk)("code",null,"Y"),(0,t.eW)("轴朝下为正方向，所以反"),(0,t.Lk)("code",null,"Tan"),(0,t.eW)("后需要反转一下。")],-1),e={},c=(0,a(66262).A)(e,[["render",function(n,s){const a=(0,t.g2)("chatmessage");return(0,t.uX)(),(0,t.CE)("div",null,[p,(0,t.bF)(a,{avatar:"../../../assets/emoji/new9.png",avatarWidth:40,alignLeft:""},{default:(0,t.k6)((()=>[o])),_:1})])}]]),l=JSON.parse('{"path":"/unreal/ui_%E6%8E%A7%E4%BB%B6_/7-CommonUIFocus.html","title":"Umg.UI焦点问题","lang":"zh-CN","frontmatter":{"title":"Umg.UI焦点问题","order":7,"category":["unreal"],"description":"UI焦点问题 导言 最近在做道具轮盘，大致流程是按下某个按键，弹出一个轮盘，使用鼠标或者手柄来选择某个插槽。 本篇记录一下实现中的一些坑。 实现原理","head":[["meta",{"property":"og:url","content":"https://rendertool.github.io/RenderDoc/unreal/ui_%E6%8E%A7%E4%BB%B6_/7-CommonUIFocus.html"}],["meta",{"property":"og:site_name","content":"RenderDoc"}],["meta",{"property":"og:title","content":"Umg.UI焦点问题"}],["meta",{"property":"og:description","content":"UI焦点问题 导言 最近在做道具轮盘，大致流程是按下某个按键，弹出一个轮盘，使用鼠标或者手柄来选择某个插槽。 本篇记录一下实现中的一些坑。 实现原理"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-22T08:42:32.000Z"}],["meta",{"property":"article:author","content":"Mr.Si"}],["meta",{"property":"article:modified_time","content":"2025-08-22T08:42:32.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Umg.UI焦点问题\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-22T08:42:32.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Si\\",\\"url\\":\\"https://rendertool.github.io/RenderDoc/\\"}]}"]]},"headers":[{"level":2,"title":"UI焦点问题","slug":"ui焦点问题","link":"#ui焦点问题","children":[]},{"level":2,"title":"导言","slug":"导言","link":"#导言","children":[{"level":3,"title":"实现原理","slug":"实现原理","link":"#实现原理","children":[]}]}],"git":{"createdTime":1755852152000,"updatedTime":1755852152000,"contributors":[{"name":"sigaohe","email":"750831855@qq.com","commits":1}]},"readingTime":{"minutes":1.02,"words":305},"filePathRelative":"unreal/ui[控件]/7-CommonUIFocus.md","localizedDate":"2025年8月22日","excerpt":"<h2>UI焦点问题</h2>\\n<h2>导言</h2>\\n<blockquote>\\n<p>最近在做道具轮盘，大致流程是按下某个按键，弹出一个轮盘，使用鼠标或者手柄来选择某个插槽。\\n本篇记录一下实现中的一些坑。</p>\\n</blockquote>\\n<h3>实现原理</h3>\\n<div class=\\"language-cpp\\" data-ext=\\"cpp\\" data-title=\\"cpp\\"><pre class=\\"language-cpp\\"><code>\\nFVector2D <span class=\\"token class-name\\">URadialWheelWidget</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">GetWheelCenterPosition</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token punctuation\\">{</span>\\n\\t<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span>WheelOverlay<span class=\\"token punctuation\\">)</span>\\n\\t<span class=\\"token punctuation\\">{</span>\\n\\t\\t<span class=\\"token keyword\\">return</span> FVector2D<span class=\\"token double-colon punctuation\\">::</span>ZeroVector<span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token punctuation\\">}</span>\\n\\n\\t<span class=\\"token comment\\">// 获取 Overlay 的几何信息</span>\\n\\t<span class=\\"token keyword\\">const</span> FGeometry<span class=\\"token operator\\">&amp;</span> Geometry <span class=\\"token operator\\">=</span> WheelOverlay<span class=\\"token operator\\">-&gt;</span><span class=\\"token function\\">GetCachedGeometry</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n\\t<span class=\\"token comment\\">// 本地中心点</span>\\n\\t<span class=\\"token keyword\\">const</span> FVector2D LocalCenter <span class=\\"token operator\\">=</span> Geometry<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">GetLocalSize</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">*</span> <span class=\\"token number\\">0.5f</span><span class=\\"token punctuation\\">;</span>\\n\\n\\t<span class=\\"token comment\\">// 转换到绝对屏幕坐标</span>\\n\\tFVector2D PixelPosition<span class=\\"token punctuation\\">;</span>\\n\\tFVector2D ViewportPosition<span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token class-name\\">USlateBlueprintLibrary</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">LocalToViewport</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">,</span> Geometry<span class=\\"token punctuation\\">,</span> LocalCenter<span class=\\"token punctuation\\">,</span> PixelPosition<span class=\\"token punctuation\\">,</span> ViewportPosition<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n\\t<span class=\\"token comment\\">// 加上DPI缩放</span>\\n\\t<span class=\\"token keyword\\">return</span> ViewportPosition <span class=\\"token operator\\">*</span> <span class=\\"token class-name\\">UWidgetLayoutLibrary</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">GetViewportScale</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token keyword\\">void</span> <span class=\\"token class-name\\">URadialWheelWidget</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">CalcAngleAndDistanceFromDir</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">const</span> FVector2D<span class=\\"token operator\\">&amp;</span> Dir<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">float</span><span class=\\"token operator\\">&amp;</span> OutAngle<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">double</span><span class=\\"token operator\\">&amp;</span> OutDistance<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">const</span>\\n<span class=\\"token punctuation\\">{</span>\\n\\tOutDistance <span class=\\"token operator\\">=</span> Dir<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Size</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n\\t<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span>Dir<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">IsNearlyZero</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n\\t<span class=\\"token punctuation\\">{</span>\\n\\t    <span class=\\"token comment\\">// Y 翻转</span>\\n\\t\\tOutAngle <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">FMath</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">RadiansToDegrees</span><span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\">FMath</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">Atan2</span><span class=\\"token punctuation\\">(</span>Dir<span class=\\"token punctuation\\">.</span>Y<span class=\\"token punctuation\\">,</span> Dir<span class=\\"token punctuation\\">.</span>X<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">+</span> <span class=\\"token number\\">90.f</span><span class=\\"token punctuation\\">;</span>\\n\\t\\tOutAngle <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">FRotator</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">ClampAxis</span><span class=\\"token punctuation\\">(</span>OutAngle<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token punctuation\\">}</span>\\n\\t<span class=\\"token keyword\\">else</span>\\n\\t<span class=\\"token punctuation\\">{</span>\\n\\t\\tOutDistance <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0.0</span><span class=\\"token punctuation\\">;</span>\\n\\t\\tOutAngle <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0.f</span><span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">}</span>\\nFVector2D <span class=\\"token class-name\\">URadialWheelWidget</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">GetMousePosition</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token keyword\\">float</span> Angle <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0.f</span><span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token keyword\\">double</span> Distance <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0.0</span><span class=\\"token punctuation\\">;</span>\\n\\n\\t<span class=\\"token comment\\">//1. 获取鼠标在屏幕中的绝对位置（考虑DPI缩放）</span>\\n\\t<span class=\\"token keyword\\">const</span> FVector2D MousePos <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">UWidgetLayoutLibrary</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">GetMousePositionOnViewport</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">*</span>\\n\\t\\t\\t\\t\\t\\t\\t<span class=\\"token class-name\\">UWidgetLayoutLibrary</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">GetViewportScale</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token comment\\">//2.获取轮盘中心坐标</span>\\n\\t<span class=\\"token keyword\\">const</span> FVector2D Center <span class=\\"token operator\\">=</span> <span class=\\"token function\\">GetWheelCenterPosition</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token comment\\">//3.计算偏移向量</span>\\n\\t<span class=\\"token keyword\\">const</span> FVector2D Dir <span class=\\"token operator\\">=</span> MousePos <span class=\\"token operator\\">-</span> Center<span class=\\"token punctuation\\">;</span>\\n\\t\\n\\t<span class=\\"token comment\\">//4.计算角度和距离</span>\\n\\t<span class=\\"token function\\">CalcAngleAndDistanceFromDir</span><span class=\\"token punctuation\\">(</span>Dir<span class=\\"token punctuation\\">,</span> Angle<span class=\\"token punctuation\\">,</span> Distance<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\t\\n</code></pre></div>","autoDesc":true}')}}]);