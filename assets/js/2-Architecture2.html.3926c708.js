"use strict";(self.webpackChunkrenderdoc=self.webpackChunkrenderdoc||[]).push([[1678],{71500:(n,a,s)=>{s.r(a),s.d(a,{comp:()=>g,data:()=>f});var t=s(20641);const e=s.p+"assets/img/hotfix031.a5221534.png",p=s.p+"assets/img/hotfix2.8ad7333b.svg",o=s.p+"assets/img/wljg001.81f49032.png",i=(0,t.Lk)("h2",{id:"前情回顾",tabindex:"-1"},[(0,t.Lk)("a",{class:"header-anchor",href:"#前情回顾"},[(0,t.Lk)("span",null,"前情回顾")])],-1),l=(0,t.Lk)("p",null,"前文中，咱们已经讨论了2个非常简陋的更新方案了，并且咱们已经意识到恶意破坏补丁带来的灾难性BUG，本文将继续抽丝剥茧，实践优化完善我们的方案。",-1),c=(0,t.Lk)("h2",{id:"校验",tabindex:"-1"},[(0,t.Lk)("a",{class:"header-anchor",href:"#校验"},[(0,t.Lk)("span",null,"校验")])],-1),u=(0,t.Fv)('<h3 id="获取文件md5-hash" tabindex="-1"><a class="header-anchor" href="#获取文件md5-hash"><span>获取文件MD5(HASH)</span></a></h3><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>FMD5Hash CurrentPakHash <span class="token operator">=</span> <span class="token class-name">FMD5Hash</span><span class="token double-colon punctuation">::</span><span class="token function">HashFile</span><span class="token punctuation">(</span><span class="token operator">*</span>InFile<span class="token punctuation">)</span><span class="token punctuation">;</span>\nFString CurrentPakHashString <span class="token operator">=</span> <span class="token function">LexToString</span><span class="token punctuation">(</span>CurrentPakHash<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="工具函数" tabindex="-1"><a class="header-anchor" href="#工具函数"><span>工具函数</span></a></h3><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token function">USTRUCT</span><span class="token punctuation">(</span>BlueprintType<span class="token punctuation">)</span>\n<span class="token keyword">struct</span> <span class="token class-name">FPakFileInfo</span>\n<span class="token punctuation">{</span>\n\t<span class="token function">GENERATED_USTRUCT_BODY</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">public</span><span class="token operator">:</span>\n\n\t<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditAnywhere<span class="token punctuation">,</span>BlueprintReadWrite<span class="token punctuation">)</span>\n\tFString FileName<span class="token punctuation">;</span>\n\t<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditAnywhere<span class="token punctuation">,</span>BlueprintReadWrite<span class="token punctuation">)</span>\n\tFString Hash<span class="token punctuation">;</span>\n\t<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditAnywhere<span class="token punctuation">,</span>BlueprintReadWrite<span class="token punctuation">)</span>\n\tint32 FileSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">bool</span> <span class="token class-name">UFlibPatchParserHelper</span><span class="token double-colon punctuation">::</span><span class="token function">GetPakFileInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> FString<span class="token operator">&amp;</span> InFile<span class="token punctuation">,</span> FPakFileInfo<span class="token operator">&amp;</span> OutFileInfo<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n\t<span class="token keyword">bool</span> bRunStatus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n\t<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FPaths</span><span class="token double-colon punctuation">::</span><span class="token function">FileExists</span><span class="token punctuation">(</span>InFile<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\t<span class="token punctuation">{</span>\n\t\tFString PathPart<span class="token punctuation">;</span>\n\t\tFString FileNamePart<span class="token punctuation">;</span>\n\t\tFString ExtensionPart<span class="token punctuation">;</span>\n\n\t\t<span class="token class-name">FPaths</span><span class="token double-colon punctuation">::</span><span class="token function">Split</span><span class="token punctuation">(</span>InFile<span class="token punctuation">,</span> PathPart<span class="token punctuation">,</span> FileNamePart<span class="token punctuation">,</span> ExtensionPart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\t\tFMD5Hash CurrentPakHash <span class="token operator">=</span> <span class="token class-name">FMD5Hash</span><span class="token double-colon punctuation">::</span><span class="token function">HashFile</span><span class="token punctuation">(</span><span class="token operator">*</span>InFile<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\tOutFileInfo<span class="token punctuation">.</span>FileName <span class="token operator">=</span> <span class="token class-name">FString</span><span class="token double-colon punctuation">::</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">&quot;%s.%s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>FileNamePart<span class="token punctuation">,</span><span class="token operator">*</span>ExtensionPart<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\tOutFileInfo<span class="token punctuation">.</span>Hash <span class="token operator">=</span> <span class="token function">LexToString</span><span class="token punctuation">(</span>CurrentPakHash<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\tOutFileInfo<span class="token punctuation">.</span>FileSize <span class="token operator">=</span> <span class="token class-name">IFileManager</span><span class="token double-colon punctuation">::</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FileSize</span><span class="token punctuation">(</span><span class="token operator">*</span>InFile<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\tbRunStatus <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n\t<span class="token punctuation">}</span>\n\t<span class="token keyword">return</span> bRunStatus<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',4),r=(0,t.Lk)("h3",{id:"独立启动器",tabindex:"-1"},[(0,t.Lk)("a",{class:"header-anchor",href:"#独立启动器"},[(0,t.Lk)("span",null,"独立启动器")])],-1),d=(0,t.Lk)("figure",null,[(0,t.Lk)("img",{src:e,alt:"",tabindex:"0",loading:"lazy"}),(0,t.Lk)("figcaption")],-1),k=(0,t.Lk)("h2",{id:"方案3",tabindex:"-1"},[(0,t.Lk)("a",{class:"header-anchor",href:"#方案3"},[(0,t.Lk)("span",null,"方案3")])],-1),h=(0,t.Lk)("figure",null,[(0,t.Lk)("img",{src:p,alt:"",tabindex:"0",loading:"lazy"}),(0,t.Lk)("figcaption")],-1),v=(0,t.Lk)("h3",{id:"临时文件",tabindex:"-1"},[(0,t.Lk)("a",{class:"header-anchor",href:"#临时文件"},[(0,t.Lk)("span",null,"临时文件")])],-1),m=(0,t.Lk)("figure",null,[(0,t.Lk)("img",{src:o,alt:"",tabindex:"0",loading:"lazy"}),(0,t.Lk)("figcaption")],-1),b={},g=(0,s(66262).A)(b,[["render",function(n,a){const s=(0,t.g2)("chatmessage");return(0,t.uX)(),(0,t.CE)("div",null,[i,l,c,(0,t.bF)(s,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:(0,t.k6)((()=>[(0,t.eW)(" 前文我们已经意识到验证本地文件的重要性，我们把这个过程暂且称之为校验 ")])),_:1}),(0,t.bF)(s,{avatar:" ../../assets/emoji/hx.png",avatarWidth:40},{default:(0,t.k6)((()=>[(0,t.eW)(" 那具体怎么校验呢？ ")])),_:1}),(0,t.bF)(s,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:(0,t.k6)((()=>[(0,t.eW)(" 如果不考虑分片，理论上每个文件都能计算出一个MD5值（哈希值），通过对比本地文件MD5和服务器MD5来验证文件是否一致。 ")])),_:1}),(0,t.bF)(s,{avatar:" ../../assets/emoji/hx.png",avatarWidth:40},{default:(0,t.k6)((()=>[(0,t.eW)(" MD5?好像百度网盘上传文件时会计算文件的MD5，如果服务器有则不上传，从而直接实现秒传。 ")])),_:1}),(0,t.bF)(s,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:(0,t.k6)((()=>[(0,t.eW)(" 是的，UE5中也有计算MD5的Help函数，咱们可以独立封装一成一个工具函数。 ")])),_:1}),u,(0,t.bF)(s,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:(0,t.k6)((()=>[(0,t.eW)(" 现在仔细回想一下腾x等游戏更新流程。 ")])),_:1}),r,(0,t.bF)(s,{avatar:" ../../assets/emoji/hx.png",avatarWidth:40},{default:(0,t.k6)((()=>[(0,t.eW)(" 我靠！他们好像不是用本体直接更新的！而是用一个类似启动器的东西！ ")])),_:1}),d,(0,t.bF)(s,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:(0,t.k6)((()=>[(0,t.eW)(" 是的，有的游戏甚至启动器都不需要登录，而是一个纯粹的游戏下载、公共展示、游戏修复工具。 ")])),_:1}),k,(0,t.bF)(s,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:(0,t.k6)((()=>[(0,t.eW)(" 咱们的方案3浮出水面了！ ")])),_:1}),h,v,m])}]]),f=JSON.parse('{"path":"/unreal/hotfix_%E7%83%AD%E6%9B%B4%E6%96%B0_/2-Architecture2.html","title":"HF|热更新02","lang":"zh-CN","frontmatter":{"title":"HF|热更新02","order":2,"category":["unreal"],"description":"前情回顾 前文中，咱们已经讨论了2个非常简陋的更新方案了，并且咱们已经意识到恶意破坏补丁带来的灾难性BUG，本文将继续抽丝剥茧，实践优化完善我们的方案。 校验 获取文件MD5(HASH) 工具函数 独立启动器 方案3 临时文件","head":[["meta",{"property":"og:url","content":"https://rendertool.github.io/RenderDoc/RenderDoc/unreal/hotfix_%E7%83%AD%E6%9B%B4%E6%96%B0_/2-Architecture2.html"}],["meta",{"property":"og:site_name","content":"RenderDoc"}],["meta",{"property":"og:title","content":"HF|热更新02"}],["meta",{"property":"og:description","content":"前情回顾 前文中，咱们已经讨论了2个非常简陋的更新方案了，并且咱们已经意识到恶意破坏补丁带来的灾难性BUG，本文将继续抽丝剥茧，实践优化完善我们的方案。 校验 获取文件MD5(HASH) 工具函数 独立启动器 方案3 临时文件"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-12T19:14:26.000Z"}],["meta",{"property":"article:author","content":"Mr.Si"}],["meta",{"property":"article:modified_time","content":"2024-08-12T19:14:26.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"HF|热更新02\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-08-12T19:14:26.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Si\\",\\"url\\":\\"https://rendertool.github.io/RenderDoc/\\"}]}"]]},"headers":[{"level":2,"title":"前情回顾","slug":"前情回顾","link":"#前情回顾","children":[]},{"level":2,"title":"校验","slug":"校验","link":"#校验","children":[{"level":3,"title":"获取文件MD5(HASH)","slug":"获取文件md5-hash","link":"#获取文件md5-hash","children":[]},{"level":3,"title":"工具函数","slug":"工具函数","link":"#工具函数","children":[]},{"level":3,"title":"独立启动器","slug":"独立启动器","link":"#独立启动器","children":[]}]},{"level":2,"title":"方案3","slug":"方案3","link":"#方案3","children":[{"level":3,"title":"临时文件","slug":"临时文件","link":"#临时文件","children":[]}]}],"git":{"createdTime":1723490066000,"updatedTime":1723490066000,"contributors":[{"name":"sigaohe","email":"750831855@qq.com","commits":1}]},"readingTime":{"minutes":1.73,"words":519},"filePathRelative":"unreal/hotfix[热更新]/2-Architecture2.md","localizedDate":"2024年8月12日","excerpt":"<h2>前情回顾</h2>\\n<p>前文中，咱们已经讨论了2个非常简陋的更新方案了，并且咱们已经意识到恶意破坏补丁带来的灾难性BUG，本文将继续抽丝剥茧，实践优化完善我们的方案。</p>\\n<h2>校验</h2>\\n\\n\\n\\n\\n\\n<h3>获取文件MD5(HASH)</h3>\\n<div class=\\"language-cpp\\" data-ext=\\"cpp\\" data-title=\\"cpp\\"><pre class=\\"language-cpp\\"><code>FMD5Hash CurrentPakHash <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">FMD5Hash</span><span class=\\"token double-colon punctuation\\">::</span><span class=\\"token function\\">HashFile</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">*</span>InFile<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\nFString CurrentPakHashString <span class=\\"token operator\\">=</span> <span class=\\"token function\\">LexToString</span><span class=\\"token punctuation\\">(</span>CurrentPakHash<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n</code></pre></div>","autoDesc":true}')}}]);