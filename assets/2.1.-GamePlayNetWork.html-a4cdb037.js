import{_ as o}from"./replicate011-149a4561.js";import{_ as l,r as p,o as d,c as r,d as a,w as t,a as n,b as s,e as c}from"./app-a94ef497.js";const u="/RenderDoc/assets/replicate012-21881826.png",m="/RenderDoc/assets/replicate013-57eb0c80.png",v="/RenderDoc/assets/replicate014-adf9effb.png",k="/RenderDoc/assets/replicate023-0502406a.jpg",b="/RenderDoc/assets/replicate015-dfc69d05.png",h="/RenderDoc/assets/replicate017-f34df7af.jpg",f="/RenderDoc/assets/replicate019-dd43dcd4.png",g="/RenderDoc/assets/replicate018-d0148d36.png",_="/RenderDoc/assets/replicate022-4c2f12b4.jpg",y="/RenderDoc/assets/replicate020-e3663f37.png",O="/RenderDoc/assets/replicate021-ed5d129e.png",R={},x=n("h2",{id:"前情提要",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#前情提要","aria-hidden":"true"},"#"),s(" 前情提要")],-1),N=n("h2",{id:"解决流程",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#解决流程","aria-hidden":"true"},"#"),s(" 解决流程")],-1),M=n("h3",{id:"bp",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#bp","aria-hidden":"true"},"#"),s(" BP")],-1),I=n("figure",null,[n("img",{src:o,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),C=c(`<h3 id="c" tabindex="-1"><a class="header-anchor" href="#c" aria-hidden="true">#</a> C++</h3><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code>   <span class="token comment">// .h</span>
   <span class="token function">UFUNCTION</span><span class="token punctuation">(</span>Server<span class="token punctuation">,</span> Reliable<span class="token punctuation">)</span>
   <span class="token keyword">void</span> <span class="token function">ServerSetHealth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// .cpp</span>
   <span class="token keyword">void</span> <span class="token class-name">AMyActor</span><span class="token double-colon punctuation">::</span><span class="token function">ServerSetHealth_Implementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
     <span class="token comment">//spawn的代码</span>
   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="本章导读" tabindex="-1"><a class="header-anchor" href="#本章导读" aria-hidden="true">#</a> 本章导读</h2>`,3),D=n("figure",null,[n("img",{src:u,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),L=n("figure",null,[n("img",{src:m,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),P=n("h2",{id:"bp-multicast",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#bp-multicast","aria-hidden":"true"},"#"),s(" BP|Multicast")],-1),E=n("figure",null,[n("img",{src:v,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),w=n("figure",null,[n("img",{src:k,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),A=c(`<h2 id="c-multicast" tabindex="-1"><a class="header-anchor" href="#c-multicast" aria-hidden="true">#</a> C++|Multicast</h2><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code>   <span class="token comment">// .h</span>
   <span class="token function">UFUNCTION</span><span class="token punctuation">(</span>Server<span class="token punctuation">,</span> Reliable<span class="token punctuation">)</span>
   <span class="token keyword">void</span> <span class="token function">ServerSetHealth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// .cpp</span>
   <span class="token keyword">void</span> <span class="token class-name">AMyActor</span><span class="token double-colon punctuation">::</span><span class="token function">ServerSetHealth_Implementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
     <span class="token function">MulticastFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
    <span class="token comment">// 在 .h </span>
    <span class="token function">UFUNCTION</span><span class="token punctuation">(</span>NetMulticast<span class="token punctuation">,</span> Reliable<span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">MulticastFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在 .cpp </span>
    <span class="token keyword">void</span> <span class="token class-name">AMyActor</span><span class="token double-colon punctuation">::</span><span class="token function">MulticastFunction_Implementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
    <span class="token comment">//实现移动逻辑。</span>
    <span class="token punctuation">}</span>
   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="变量复制" tabindex="-1"><a class="header-anchor" href="#变量复制" aria-hidden="true">#</a> 变量复制</h3>`,3),T=n("figure",null,[n("img",{src:b,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),S=n("figure",null,[n("img",{src:h,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),q=n("figure",null,[n("img",{src:f,alt:"变量没有复制",tabindex:"0",loading:"lazy"}),n("figcaption",null,"变量没有复制")],-1),V=c('<h2 id="bp-1" tabindex="-1"><a class="header-anchor" href="#bp-1" aria-hidden="true">#</a> BP</h2><h3 id="变量-replicated" tabindex="-1"><a class="header-anchor" href="#变量-replicated" aria-hidden="true">#</a> 变量|Replicated</h3><blockquote><p>开启复制后，变量右上角会出现两个泡泡。</p></blockquote><figure><img src="'+g+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',4),j=n("h3",{id:"变量-repnotify",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#变量-repnotify","aria-hidden":"true"},"#"),s(" 变量|RepNotify")],-1),W=n("figure",null,[n("img",{src:_,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),F=n("p",null,[s("至于RepNotify,是指该变量发生"),n("code",null,"变化"),s("时会触发一个回调函数，同时在服务器和客户端机器上执行此函数。")],-1),z=n("figure",null,[n("img",{src:y,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),U=c('<figure><img src="'+O+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="c-1" tabindex="-1"><a class="header-anchor" href="#c-1" aria-hidden="true">#</a> C++</h2><div class="hint-container note"><p class="hint-container-title">注</p><p>C++：在服务器中更改 OnRep 变量时，仅当变量的值发生更改时，才会在客户端上触发 OnRep 行为。 服务器不会触发 OnRep，这意味着如果我们希望在服务器中执行 OnRep 行为，我们必须从服务器显式调用它。</p><p>蓝图：当我们在服务器中设置 OnRep 变量时，OnRep 行为将始终在服务器上触发（即使变量的值没有更改）。 但是，仅当 OnRep 的变量发生更改时，才会在客户端上触发 OnRep 行为。此外，无法显式调用由 OnRep 变量创建的 OnRep 函数。</p></div><h3 id="c-replicated" tabindex="-1"><a class="header-anchor" href="#c-replicated" aria-hidden="true">#</a> C++|Replicated</h3><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// 在 .h 文件中声明 MyVariable 变量</span>
<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>Replicated<span class="token punctuation">)</span>
<span class="token keyword">float</span> MyVariable<span class="token punctuation">;</span>

<span class="token comment">// 在 .cpp 文件中设置变量同步</span>
<span class="token keyword">void</span> <span class="token class-name">AMyActor</span><span class="token double-colon punctuation">::</span><span class="token function">GetLifetimeReplicatedProps</span><span class="token punctuation">(</span>TArray<span class="token operator">&lt;</span> FLifetimeProperty <span class="token operator">&gt;</span> <span class="token operator">&amp;</span> OutLifetimeProps<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token class-name">Super</span><span class="token double-colon punctuation">::</span><span class="token function">GetLifetimeReplicatedProps</span><span class="token punctuation">(</span>OutLifetimeProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">DOREPLIFETIME</span><span class="token punctuation">(</span>AMyActor<span class="token punctuation">,</span> MyVariable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="c-repnotify-onrep" tabindex="-1"><a class="header-anchor" href="#c-repnotify-onrep" aria-hidden="true">#</a> C++|RepNotify|OnRep</h3><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// 在 .h 文件中声明 MyVariable 变量</span>
<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>ReplicatedUsing <span class="token operator">=</span> OnRep_MyVariable<span class="token punctuation">)</span>
<span class="token keyword">float</span> MyVariable<span class="token punctuation">;</span>

<span class="token comment">// 在 .cpp 文件中设置变量同步，并声明 OnRep_MyVariable 函数</span>
<span class="token keyword">void</span> <span class="token class-name">AMyActor</span><span class="token double-colon punctuation">::</span><span class="token function">GetLifetimeReplicatedProps</span><span class="token punctuation">(</span>TArray<span class="token operator">&lt;</span> FLifetimeProperty <span class="token operator">&gt;</span> <span class="token operator">&amp;</span> OutLifetimeProps<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
   <span class="token class-name">Super</span><span class="token double-colon punctuation">::</span><span class="token function">GetLifetimeReplicatedProps</span><span class="token punctuation">(</span>OutLifetimeProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="token punctuation">(</span>AMyActor<span class="token punctuation">,</span> MyVariable<span class="token punctuation">,</span> COND_SkipOwner<span class="token punctuation">,</span> REPNOTIFY_Always<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// OnRep_MyVariable 函数将在 MyVariable 发生变化时被调用</span>
<span class="token keyword">void</span> <span class="token class-name">AMyActor</span><span class="token double-colon punctuation">::</span><span class="token function">OnRep_MyVariable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 在这里添加在变量改变时执行的逻辑</span>
   <span class="token function">UE_LOG</span><span class="token punctuation">(</span>LogTemp<span class="token punctuation">,</span> Warning<span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">&quot;MyVariable changed to: %f&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MyVariable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="c-doreplifetime变量的复制规则" tabindex="-1"><a class="header-anchor" href="#c-doreplifetime变量的复制规则" aria-hidden="true">#</a> C++|<code>DOREPLIFETIME</code>变量的复制规则</h3><h4 id="doreplifetime" tabindex="-1"><a class="header-anchor" href="#doreplifetime" aria-hidden="true">#</a> DOREPLIFETIME:</h4><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token function">DOREPLIFETIME</span><span class="token punctuation">(</span>ClassName<span class="token punctuation">,</span> VariableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个宏用于声明一个类的变量需要在网络上进行复制。它会自动生成必要的复制代码。</p><h4 id="doreplifetime-condition" tabindex="-1"><a class="header-anchor" href="#doreplifetime-condition" aria-hidden="true">#</a> DOREPLIFETIME_CONDITION:</h4>`,12),G=c(`<div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token function">DOREPLIFETIME_CONDITION</span><span class="token punctuation">(</span>ClassName<span class="token punctuation">,</span> VariableName<span class="token punctuation">,</span> ReplicationCondition<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个宏也用于声明一个类的变量需要在网络上进行复制，但允许添加一个额外的条件。<code>ReplicationCondition</code> 是一个用于判断是否进行复制的布尔表达式。只有在这个表达式为真时，复制才会发生。</p><p>示例：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token function">DOREPLIFETIME_CONDITION</span><span class="token punctuation">(</span>AMyActor<span class="token punctuation">,</span> MyVariable<span class="token punctuation">,</span> COND_SkipOwner<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th>条件标签</th><th>描述</th></tr></thead><tbody><tr><td><code>COND_InitialOnly</code></td><td>仅在初始数据组尝试发送</td></tr><tr><td><code>COND_OwnerOnly</code></td><td>仅发送至 actor 的所有者</td></tr><tr><td><code>COND_SkipOwner</code></td><td>发送至除所有者之外的每个连接</td></tr><tr><td><code>COND_SimulatedOnly</code></td><td>仅发送至模拟 actor</td></tr><tr><td><code>COND_AutonomousOnly</code></td><td>仅发送给自治 actor</td></tr><tr><td><code>COND_SimulatedOrPhysics</code></td><td>发送至模拟或 <code>bRepPhysics</code> actor</td></tr><tr><td><code>COND_InitialOrOwner</code></td><td>发送初始数据包，或者发送至 actor 所有者</td></tr><tr><td><code>COND_Custom</code></td><td>没有特定条件，但需要通过 <code>SetCustomIsActiveOverride</code> 开启/关闭能力</td></tr></tbody></table>`,5);function B(H,Y){const e=p("chatmessage"),i=p("gifwithbutton");return d(),r("div",null,[x,a(e,{avatar:"../../assets/emoji/bqb (1).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 前文，咱们已经解决了客户端SpawnActor服务端不显示的问题。 ")]),_:1}),N,M,a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 定义一个在服务器上调用的事件，并确保Actor本身可以复制。 ")]),_:1}),I,a(i,{src:"../../assets/unrealgif/hpup12.gif"}),C,a(e,{avatar:" ../../assets/emoji/bqb (6).png",avatarWidth:40},{default:t(()=>[s(" 我修改了角色的速度，也调用了服务器上执行。为什么客户端上一卡一卡的？ ")]),_:1}),D,a(i,{src:"../../assets/unrealgif/hpup13.gif"}),a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 速度是角色移动组件的属性 ")]),_:1}),L,a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 官方并没有个速度这个变量搞成可复制的。虽然你现在RunOnServer，并没有同步给其他客户端。 ")]),_:1}),a(i,{src:"../../assets/unrealgif/hpup14.gif"}),P,a(e,{avatar:" ../../assets/emoji/bqb (6).png",avatarWidth:40},{default:t(()=>[s(" 也就是说，RPC申请在服务器上调用，还需要广播给所有客户端？ ")]),_:1}),E,w,a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 没错。 ")]),_:1}),A,a(e,{avatar:" ../../assets/emoji/bqb (6).png",avatarWidth:40},{default:t(()=>[s(" 为什么这里的速度不复制也能正常运行？ ")]),_:1}),a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 速度虽然没有同步，但在所有端的变化量是一致的。 ")]),_:1}),T,a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 现在可以将其中一个变量提取出来，设置成所谓MaxSpeed。用一个按键改变速度，你就会发现猫腻。 ")]),_:1}),S,a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 服务器才有权威，没毛病。 ")]),_:1}),q,a(i,{src:"../../assets/unrealgif/hpup15.gif"}),a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 可以看到虽然客户端速度降下来了，但还是一抽一抽的。现在我们开启变量的复制功能， ")]),_:1}),V,a(i,{src:"../../assets/unrealgif/hpup16.gif"}),a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 可以看到抽搐消失了，请忽略我们的动作还是跑步，因为目前的角色并不是速度驱动动作的。 ")]),_:1}),j,W,a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[F]),_:1}),z,a(i,{src:"../../assets/unrealgif/hpup17.gif"}),a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 例如OnRep_PlayerState这种就是RepNotify ")]),_:1}),U,a(e,{avatar:"../../assets/emoji/bqb (2).png",avatarWidth:40,alignLeft:""},{default:t(()=>[s(" 当然，这里的通知可以限定一些行为，比如谁才能收到。 ")]),_:1}),G])}const K=l(R,[["render",B],["__file","2.1.-GamePlayNetWork.html.vue"]]);export{K as default};
